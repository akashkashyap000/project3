-- SQL queries Sales Order Dashboard
-- 1 Total Revenue
SELECT SUM(amount) AS total_revenue
FROM saless;

-- 2 Total Profit
SELECT SUM(profit) AS total_profit
FROM saless;

-- 3 Profit Margin (%)	
SELECT 
    ROUND(SUM(profit) / SUM(amount) * 100, 2) AS profit_margin_pct
FROM saless;

-- 4 Total Quantity Sold
SELECT SUM(quantity) AS total_quantity_sold
FROM saless;

-- SALES PERFORMANCE ANALYSIS
-- (Revenue, Profit, Quantity)
SELECT 
    SUM(amount) AS total_revenue,
    SUM(profit) AS total_profit,
    SUM(quantity) AS total_quantity
FROM saless;

-- TREND ANALYSIS (MoM)
-- 5 MoM Revenue Growth (%)
SELECT 
    year,
    month,
    total_revenue,
    ROUND(
        (total_revenue - LAG(total_revenue) OVER (ORDER BY year, month)) /
        LAG(total_revenue) OVER (ORDER BY year, month) * 100, 2
    ) AS mom_revenue_growth_pct
FROM (
    SELECT 
        YEAR(order_date) AS year,
        MONTH(order_date) AS month,
        SUM(amount) AS total_revenue
    FROM saless
    GROUP BY YEAR(order_date), MONTH(order_date)
) t;

-- 6 MoM Profit Growth (%)
SELECT 
    year,
    month,
    total_profit,
    ROUND(
        (total_profit - LAG(total_profit) OVER (ORDER BY year, month)) /
        LAG(total_profit) OVER (ORDER BY year, month) * 100, 2
    ) AS mom_profit_growth_pct
FROM (
    SELECT 
        YEAR(order_date) AS year,
        MONTH(order_date) AS month,
        SUM(profit) AS total_profit
    FROM saless
    GROUP BY YEAR(order_date), MONTH(order_date)
) t;

-- CATEGORY & SUB-CATEGORY PERFORMANCE
SELECT 
    category,
    sub_category,
    SUM(amount) AS total_revenue,
    SUM(profit) AS total_profit,
    SUM(quantity) AS total_quantity
FROM saless
GROUP BY category, sub_category
ORDER BY total_revenue DESC;

-- GEOGRAPHY ANALYSIS (State)
SELECT 
    state,
    SUM(amount) AS total_revenue,
    SUM(profit) AS total_profit,
    SUM(quantity) AS total_quantity
FROM saless
GROUP BY state
ORDER BY total_revenue DESC;

-- CUSTOMER & PAYMENT MODE INSIGHTS
-- Customer-wise Performance
SELECT 
    customername,
    SUM(amount) AS total_revenue,
    SUM(profit) AS total_profit
FROM saless
GROUP BY customername
ORDER BY total_revenue DESC
LIMIT 10;

-- Payment Mode Impact
SELECT 
    paymentmode,
    COUNT(order_id) AS total_orders,
    SUM(amount) AS total_revenue,
    SUM(profit) AS total_profit
FROM saless
GROUP BY paymentmode
ORDER BY total_revenue DESC;
--  CUSTOM: High Revenue â€“ Low Profit (Margin Issue)
SELECT 
    category,
    sub_category,
    SUM(amount) AS total_revenue,
    SUM(profit) AS total_profit,
    ROUND(SUM(profit) / SUM(amount) * 100, 2) AS profit_margin_pct
FROM saless
GROUP BY category, sub_category
HAVING SUM(amount) > 50000
   AND (SUM(profit) / SUM(amount)) < 0.10
ORDER BY profit_margin_pct;
